<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>Untitled Page</title>
    <script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-1.9.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="dataset_colors.css">
    <link href='http://fonts.googleapis.com/css?family=Days+One' rel='stylesheet' type='text/css'>
    <script>

        var params = ["OS", "Analysis", "Classification", "Date", "Analysis_Parameters", "Classes"];
        var colors = ["MediumPurple", "steelblue", "DarkSeaGreen", "MediumPurple", "steelblue", "DarkSeaGreen"];

        var options = {};
        options["OS"] = ["Windows", "Linux"];
        options["Analysis"] = [
            "CPU Utilization and C Power States",
            "Host Memory Utilization",
            "Host Uptime and downtime periods",
            "CPU Thermal Sensor",
            "MultiCoreConcureentIdle"];
        options["Classification"] = ["HOSTPLATFORM", "PRODUCTFAMILY", "MAXCLOCKSPEED", "BRANDSTRING", "NUMPHYSICAL", "NUMCORES", "NUMLOGICAL", "COREPERPHYSICAL"];
        options["Date"] = []
        options["Analysis_Parameters"] = [];
        options["Classes"] = [];

        Analysis_Parameters = {};
        Analysis_Parameters["CPU Utilization and C Power States"] = ["Busy", "Idle", "C0", "C1", "C2", "C3", "C1C2C3", "C2C3"];
        Analysis_Parameters["Host Memory Utilization"] = ["PERCENT_MEMUTIL"];
        Analysis_Parameters["Host Uptime and downtime periods"] = ["NUMPERDAY_DOWN", "NUMPERDAY_MIXED", "NUMPERDAY_OFF", "NUMPERDAY_OFFONLY", "NUMPERDAY_SUSPEND",
         "NUMPERDAY_SUSPENDONLY", "PERCENT_DOWNTIME", "PERCENT_MIXEDTIME", "PERCENT_OFFONLYTIME", "PERCENT_OFFTIME", "PERCENT_SUSPENDONLYTIME",
          "PERCENT_SUSPENDTIME", "PERCENT_UPTIME", "REGISTERED_TIME", "SEMAOFF_TIME"];

        var selections = {};

        $(document).ready(function () {

            params.forEach(function (param, i) {

                var $paramDiv = $('<div></div>').css("background-color", colors[i]).attr('class', "param_div").attr('id', param);
                $('#inputs').append($paramDiv);

                $('<h1></h1>').text((i + 1) + ") " + param).click(openThis).css('cursor', 'pointer').appendTo($paramDiv);
                var selectorDiv = $('<div></div>').appendTo($paramDiv)

                if (param != "Classes") {
                    $('<div class="styled-select"><select name="' + param + '"><option>Select ' + param + '</option></select></div>').appendTo(selectorDiv);

                    options[param].forEach(function (opt2, j) {
                        selectorDiv.find('select').append($('<option></option>').attr('value', opt2).text(opt2));
                    })
                } else {
                    selectorDiv.css("overflow-y","scroll");
                }



            });

            $('select').change(function () {
                $(this).parent().parent().animate({ height: '0px' }, "slow", "swing", function () {
                    $(this).parent().next().children().eq(1).animate({ height: '100px' }, { easing: "swing" });
                });

                if (($(this).attr("name") == "Analysis")) {
                    var selectedAnalysis = $(this).find(":selected").text();
                    selections["selectedAnalysis"] = selectedAnalysis;

                    Analysis_Parameters[selectedAnalysis].forEach(function (p, i) {

                        //TO DO: first clear the current options
                        $('[name=Analysis_Parameters]').append('<option value=' + p + '>' + p + '</option>');
                    });

                    $.getJSON('/Plot/options', { analysis: selectedAnalysis}, function (dates) {
                        dates.forEach(function (opt2, j) {
                            var date_stamp = new Date(opt2 * 1000);


                            //TO DO: first clear the current options
                            $('select[name=Date]').append($('<option></option>').attr('value', opt2).text(date_stamp.toLocaleDateString()));
                        })
                    });


                } else if (($(this).attr("name") == "Classification")) {
                    var selectedClassification = $(this).find(":selected").text();
                    selections["selectedClassification"] = selectedClassification;

                } else if (($(this).attr("name") == "Date")) {

                    $.getJSON('/Plot/options', { analysis: selections["selectedAnalysis"], param: selections["selectedClassification"], time: $(this).val() }, function (classes) {

                        classes.forEach(function (p, i) {
                            var checkItem = $('<input type="checkbox" name="series" value="' + p + '">')
                                .change(function () {
                                    if ($('input:checkbox:checked').length > 3) {
                                        $(this).attr("checked", false);
                                        alert('Cannot check more than 3 items.');
                                    }
                                });

                            $('#Classes.param_div div').append(checkItem).append(p + '<br>');
                        });

                    });
                }

            });

            function openThis() {
                $(this).next().animate({ height: '100px' }, { easing: "swing" });
                $(this).unbind('click', openThis);
                $(this).click(closeThis);
            }

            function closeThis() {
                $(this).next().animate({ height: '0px' }, { easing: "swing" });
                $(this).unbind('click', closeThis);
                $(this).click(openThis);
            }

            $('.param_div div').first().animate({ height: '50px' }, { easing: "swing" });

        });
    </script>
</head>
<body style="margin: 0px; background-color: MediumPurple;">

    <form method="post" action="/Plot/Test">
        <div id="inputs"></div>
        <input id="plotButton" class="button" type="submit" value="Plot data">
    </form>
</body>
</html>
